var P=Object.defineProperty;var j=(e,t)=>()=>(e&&(t=e(e=0)),t);var H=(e,t)=>{for(var s in t)P(e,s,{get:t[s],enumerable:!0})};var I={};H(I,{Analyzer:()=>h,default:()=>ee,init:()=>q,initSync:()=>Z});function q(){c.init()}function S(){return{__proto__:null,"./ai_art_analyzer_bg.js":{__proto__:null,__wbg___wbindgen_debug_string_0bc8482c6e3508ae:function(t,s){let n=z(s),r=F(n,c.__wbindgen_malloc,c.__wbindgen_realloc),i=m;M().setInt32(t+4,i,!0),M().setInt32(t+0,r,!0)},__wbg___wbindgen_throw_be289d5034ed271b:function(t,s){throw new Error(R(t,s))},__wbg_error_7534b8e9a36f1ab4:function(t,s){let n,r;try{n=t,r=s,console.error(R(t,s))}finally{c.__wbindgen_free(n,r,1)}},__wbg_new_361308b2356cecd0:function(){return new Object},__wbg_new_3eb36ae241fe6f44:function(){return new Array},__wbg_new_8a6f238a6ece86ea:function(){return new Error},__wbg_set_3f1d0b984ed272ed:function(t,s,n){t[s]=n},__wbg_set_f43e577aea94465b:function(t,s,n){t[s>>>0]=n},__wbg_stack_0ed75d68575b0f3c:function(t,s){let n=s.stack,r=F(n,c.__wbindgen_malloc,c.__wbindgen_realloc),i=m;M().setInt32(t+4,i,!0),M().setInt32(t+0,r,!0)},__wbindgen_cast_0000000000000001:function(t){return t},__wbindgen_cast_0000000000000002:function(t,s){return R(t,s)},__wbindgen_init_externref_table:function(){let t=c.__wbindgen_externrefs,s=t.grow(4);t.set(0,void 0),t.set(s+0,void 0),t.set(s+1,null),t.set(s+2,!0),t.set(s+3,!1)}}}}function z(e){let t=typeof e;if(t=="number"||t=="boolean"||e==null)return`${e}`;if(t=="string")return`"${e}"`;if(t=="symbol"){let r=e.description;return r==null?"Symbol":`Symbol(${r})`}if(t=="function"){let r=e.name;return typeof r=="string"&&r.length>0?`Function(${r})`:"Function"}if(Array.isArray(e)){let r=e.length,i="[";r>0&&(i+=z(e[0]));for(let a=1;a<r;a++)i+=", "+z(e[a]);return i+="]",i}let s=/\[object ([^\]]+)\]/.exec(toString.call(e)),n;if(s&&s.length>1)n=s[1];else return toString.call(e);if(n=="Object")try{return"Object("+JSON.stringify(e)+")"}catch{return"Object"}return e instanceof Error?`${e.name}: ${e.message}
${e.stack}`:n}function M(){return(f===null||f.buffer.detached===!0||f.buffer.detached===void 0&&f.buffer!==c.memory.buffer)&&(f=new DataView(c.memory.buffer)),f}function R(e,t){return e=e>>>0,X(e,t)}function b(){return(_===null||_.byteLength===0)&&(_=new Uint8Array(c.memory.buffer)),_}function J(e,t){let s=t(e.length*1,1)>>>0;return b().set(e,s/1),m=e.length,s}function F(e,t,s){if(s===void 0){let d=p.encode(e),l=t(d.length,1)>>>0;return b().subarray(l,l+d.length).set(d),m=d.length,l}let n=e.length,r=t(n,1)>>>0,i=b(),a=0;for(;a<n;a++){let d=e.charCodeAt(a);if(d>127)break;i[r+a]=d}if(a!==n){a!==0&&(e=e.slice(a)),r=s(r,n,n=a+e.length*3,1)>>>0;let d=b().subarray(r+a,r+n),l=p.encodeInto(e,d);a+=l.written,r=s(r,n,a,1)>>>0}return m=a,r}function X(e,t){return C+=t,C>=K&&(x=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}),x.decode(),C=t),x.decode(b().subarray(e,e+t))}function $(e,t){return c=e.exports,Y=t,f=null,_=null,c.__wbindgen_start(),c}async function Q(e,t){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,t)}catch(r){if(e.ok&&s(e.type)&&e.headers.get("Content-Type")!=="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}let n=await e.arrayBuffer();return await WebAssembly.instantiate(n,t)}else{let n=await WebAssembly.instantiate(e,t);return n instanceof WebAssembly.Instance?{instance:n,module:e}:n}function s(n){switch(n){case"basic":case"cors":case"default":return!0}return!1}}function Z(e){if(c!==void 0)return c;e!==void 0&&(Object.getPrototypeOf(e)===Object.prototype?{module:e}=e:console.warn("using deprecated parameters for `initSync()`; pass a single object instead"));let t=S();e instanceof WebAssembly.Module||(e=new WebAssembly.Module(e));let s=new WebAssembly.Instance(e,t);return $(s,e)}async function ee(e){if(c!==void 0)return c;e!==void 0&&(Object.getPrototypeOf(e)===Object.prototype?{module_or_path:e}=e:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),e===void 0&&(e=new URL("ai_art_analyzer_bg.wasm",import.meta.url));let t=S();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));let{instance:s,module:n}=await Q(await e,t);return $(s,n)}var h,E,f,_,x,K,C,p,m,Y,c,v=j(()=>{"use strict";h=class{__destroy_into_raw(){let t=this.__wbg_ptr;return this.__wbg_ptr=0,E.unregister(this),t}free(){let t=this.__destroy_into_raw();c.__wbg_analyzer_free(t,0)}analyze(){return c.analyzer_analyze(this.__wbg_ptr)}constructor(t,s,n){let r=J(t,c.__wbindgen_malloc),i=m,a=c.analyzer_new(r,i,s,n);return this.__wbg_ptr=a>>>0,E.register(this,this.__wbg_ptr,this),this}};Symbol.dispose&&(h.prototype[Symbol.dispose]=h.prototype.free);E=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>c.__wbg_analyzer_free(e>>>0,1));f=null;_=null;x=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});x.decode();K=2146435072,C=0;p=new TextEncoder;"encodeInto"in p||(p.encodeInto=function(e,t){let s=p.encode(e);return t.set(s),{read:e.length,written:s.length}});m=0});var w=e=>Math.max(0,Math.min(1,e)),L=e=>{e=w(e);let t,s,n;return e<.125?(t=0,s=0,n=.5+e*4):e<.375?(t=0,s=(e-.125)*4,n=1):e<.625?(t=(e-.375)*4,s=1,n=1-(e-.375)*4):e<.875?(t=1,s=1-(e-.625)*4,n=0):(t=1-(e-.875)*4,s=0,n=0),[Math.round(t*255),Math.round(s*255),Math.round(n*255)]},k=e=>{e=w(e);let t,s,n;return e<.33?(t=e*3,s=0,n=0):e<.67?(t=1,s=(e-.33)*3,n=0):(t=1,s=1,n=(e-.67)*3),[Math.round(t*255),Math.round(s*255),Math.round(n*255)]},T=(e,t)=>{t=w(t);let s=t*(e.length-1),n=Math.floor(s),r=Math.min(n+1,e.length-1),i=s-n;return[Math.round(e[n][0]+i*(e[r][0]-e[n][0])),Math.round(e[n][1]+i*(e[r][1]-e[n][1])),Math.round(e[n][2]+i*(e[r][2]-e[n][2]))]},U=e=>T([[68,1,84],[72,40,120],[62,74,137],[49,104,142],[38,130,142],[31,158,137],[53,183,121],[109,205,89],[180,222,44],[253,231,37]],e),N=e=>T([[13,8,135],[75,3,161],[125,3,168],[168,34,150],[203,70,121],[229,107,93],[248,148,65],[253,195,40],[240,249,33]],e),G=e=>{e=w(e);let t,s,n;return e<.375?(t=e*7/8,s=e*7/8,n=e*7/8+e/3):e<.75?(t=e*7/8,s=e*7/8+(e-.375)/3,n=.453125+(e-.375)*7/8):(t=.65625+(e-.75)/3+(e-.75)*7/8,s=.78125+(e-.75)*7/8,n=.78125+(e-.75)*7/8),[Math.round(Math.min(1,t)*255),Math.round(Math.min(1,s)*255),Math.round(Math.min(1,n)*255)]},V={jet:L,hot:k,viridis:U,plasma:N,bone:G};function A(e,t,s,n){let r=V[n]||L,i=new Uint8ClampedArray(t*s*4);for(let a=0;a<e.length;a++){let d=e[a]/255,[l,W,O]=r(d),y=a*4;i[y]=l,i[y+1]=W,i[y+2]=O,i[y+3]=255}return i}var D,o=e=>document.getElementById(e),te=[{canvas:o("noiseCanvas"),result:o("noiseResult"),colormap:"jet",getResult:e=>e.noise,formatMetrics:e=>`Mean: ${e.metrics[0][1].toFixed(2)} | STD: ${e.metrics[1][1].toFixed(2)}`},{canvas:o("highpassCanvas"),result:o("highpassResult"),colormap:"hot",getResult:e=>e.high_pass,formatMetrics:e=>`Mean: ${e.metrics[0][1].toFixed(2)} | STD: ${e.metrics[1][1].toFixed(2)}`},{canvas:o("elaCanvas"),result:o("elaResult"),colormap:"hot",getResult:e=>e.ela,formatMetrics:e=>`Mean: ${e.metrics[0][1].toFixed(2)}`},{canvas:o("posterizeCanvas"),result:o("posterizeResult"),colormap:"viridis",getResult:e=>e.posterize,formatMetrics:e=>`Mean: ${e.metrics[0][1].toFixed(2)}`},{canvas:o("channelCanvas"),result:o("channelResult"),colormap:"plasma",getResult:e=>e.channels,formatMetrics:e=>`Mean: ${e.metrics[0][1].toFixed(2)} | STD: ${e.metrics[1][1].toFixed(2)}`},{canvas:o("fftCanvas"),result:o("fftResult"),colormap:"bone",getResult:e=>e.fft,formatMetrics:e=>`Cross Score: ${e.metrics[0][1].toFixed(3)}`,size:e=>e.fft_size},{canvas:o("noisePatternsCanvas"),result:o("noisePatternsResult"),colormap:"plasma",getResult:e=>e.noise_patterns,formatMetrics:e=>{let t=e.metrics.find(n=>n[0]==="uniformity")?.[1]??0,s=e.metrics.find(n=>n[0]==="directional_bias")?.[1]??0;return`Type: ${e.is_ai?"AI":"Brush"} | Dir: ${s.toFixed(3)}`}},{canvas:o("gradientsCanvas"),result:o("gradientsResult"),colormap:"hot",getResult:e=>e.gradients,formatMetrics:e=>`Perfect: ${((e.metrics.find(s=>s[0]==="perfect_ratio")?.[1]??0)*100).toFixed(1)}% of gradients`},{canvas:o("clipCanvas"),result:o("clipResult"),colormap:"viridis",getResult:e=>e.clip_space,formatMetrics:e=>`Coherence: ${((e.metrics.find(s=>s[0]==="coherence")?.[1]??0)*100).toFixed(1)}%`}],ne=["Noise","High Pass","ELA","Banding","Channels","FFT Cross","Brush","Gradients","Style"],u=0,g=0;async function se(){let e=await Promise.resolve().then(()=>(v(),I));await e.default(),D=e.Analyzer}function B(e){if(!e.type.startsWith("image/")){alert("Please select an image file.");return}if(e.size>10*1024*1024){alert("Image too large. Max 10MB.");return}let t=new FileReader;t.onload=s=>{let n=new Image;n.onload=()=>re(n,e),n.src=s.target?.result},t.readAsDataURL(e)}function re(e,t){let n=e.width,r=e.height;(n>800||r>800)&&(n>r?(r=r/n*800,n=800):(n=n/r*800,r=800)),u=Math.floor(n),g=Math.floor(r);let i=o("originalCanvas");i.width=u,i.height=g,i.getContext("2d").drawImage(e,0,0,u,g);let d=(t.size/1024).toFixed(1);o("imageInfo").textContent=`${e.width}x${e.height} | ${t.type} | ${d} KB`,o("upload-section").classList.add("hidden"),o("preview-section").classList.remove("hidden")}async function ie(){o("preview-section").classList.add("hidden"),o("loading-section").classList.remove("hidden"),await new Promise(i=>setTimeout(i,50));let s=o("originalCanvas").getContext("2d").getImageData(0,0,u,g);o("loaderStep").textContent="Running Rust analyzer...",await new Promise(i=>setTimeout(i,50));let r=new D(new Uint8Array(s.data.buffer),u,g).analyze();oe(r)}function oe(e){o("loading-section").classList.add("hidden"),o("results-section").classList.remove("hidden"),o("scoreValue").textContent=e.score.toString(),o("scoreCircle").className=`score-circle ${e.verdict_class}`,o("verdictText").textContent=e.verdict,o("confidenceText").textContent=`Confidence: ${e.confidence}`;let t=o("indicatorsList");t.innerHTML="";let s=[e.noise,e.high_pass,e.ela,e.posterize,e.channels,e.fft,e.noise_patterns,e.gradients,e.clip_space];ne.forEach((n,r)=>{let i=document.createElement("span");i.className=`indicator-tag ${s[r].is_ai?"detected":"clear"}`,i.innerHTML=`${s[r].is_ai?"!":"+"} ${n}`,t.appendChild(i)}),te.forEach((n,r)=>{let i=n.getResult(e),a=n.size?n.size(e):u,d=n.size?a:u,l=n.size?a:g;ae(n.canvas,i.data,d,l,n.colormap),n.result.textContent=n.formatMetrics(i),n.result.className=`panel-result ${i.is_ai?"detected":"clear"}`})}function ae(e,t,s,n,r){e.width=s,e.height=n;let i=e.getContext("2d"),a=A(t,s,n,r),d=new ImageData(a,s,n);i.putImageData(d,0,0)}function ce(){o("results-section").classList.add("hidden"),o("preview-section").classList.add("hidden"),o("upload-section").classList.remove("hidden");let e=o("imageInput");e.value=""}async function de(){await se();let e=o("imageInput"),t=o("selectBtn"),s=o("dropzone"),n=o("analyzeBtn"),r=o("resetBtn");t.addEventListener("click",i=>{i.stopPropagation(),e.click()}),s.addEventListener("click",()=>e.click()),s.addEventListener("dragover",i=>{i.preventDefault(),s.classList.add("dragover")}),s.addEventListener("dragleave",()=>{s.classList.remove("dragover")}),s.addEventListener("drop",i=>{i.preventDefault(),s.classList.remove("dragover");let a=i.dataTransfer?.files;a&&a.length>0&&B(a[0])}),e.addEventListener("change",i=>{let a=i.target.files;a&&a.length>0&&B(a[0])}),n.addEventListener("click",ie),r.addEventListener("click",ce)}document.addEventListener("DOMContentLoaded",de);
